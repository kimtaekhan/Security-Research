<?
/****************************************************
 * POST 디버깅
 * POST 방식으로 넘어온 값을 모두 출력해준다.
 * print_r($_POST);
 * exit;
 ****************************************************/

##################
## DB 접속 정보 ##
################## 
include "__dbconnect.php";
$TBNAME = "member";

#################
## 쿼리문 실행 ##
#################
/****************************************************
 * INSERT 형식 : 
 *
 * INSERT INTO member VALUES(
 * NULL, 'userid값', password('비밀번호'), '이름', '이메일', now()); 
 *
 * member 테이블 구조;
 * +----------+-------------+------+-----+---------+----------------+
 * | Field    | Type        | Null | Key | Default | Extra          |
 * +----------+-------------+------+-----+---------+----------------+
 * | id       | int(11)     | NO   | PRI | NULL    | auto_increment |
 * | userid   | varchar(30) | NO   | UNI | NULL    |                |
 * | userpw   | varchar(41) | NO   |     | NULL    |                |
 * | username | varchar(30) | NO   |     | NULL    |                |
 * | email    | varchar(50) | NO   |     | NULL    |                |
 * | date     | datetime    | YES  |     | NULL    |                |
 * +----------+-------------+------+-----+---------+----------------+
 *
 ****************************************************/

// 넘어온 POST 값을 변수에 저장한다.
$userid    = $_POST['userid'];
$userpw    = $_POST['userpw'];
$username  = $_POST['username'];
$useremail = $_POST['useremail'];

// base64 인코딩을 다시 디코딩한다.
$http_referer = base64_decode($_POST['http_referer']);

$query = "INSERT INTO $TBNAME VALUES(
          NULL, '$userid', password('$userpw'), '$username','$useremail',now())";
/****************************************************
 * query 문자열 디버깅
 * echo $query;
 * exit;
 ****************************************************/

# resource mysql_query(쿼리문, 연결정보)
$result = mysqli_query($connect, $query);

#####################
## mysql 접속 종료 ##
#####################
mysqli_close($connect);

#################
## 페이지 이동 ##
#################

?>

<script language=javascript>
    alert('회원 가입이 완료 되었습니다');
    window.close();
</script>
