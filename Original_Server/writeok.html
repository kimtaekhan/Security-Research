<?
/****************************************************
 * POST 디버깅
 * POST 방식으로 넘어온 값을 모두 출력해준다.
 * print_r($_POST);
 * exit;
 ****************************************************/

##################
## DB 접속 정보 ##
################## 
include "__dbconnect.php";
$TBNAME = $_POST['tb'];    // 테이블명

#################
## 파일 업로드 ##
#################
/* ln -s ../data . */
$tmpfile = $_FILES['upfile']['tmp_name'];
$newfile = "./data/" . $_FILES['upfile']['name'];
move_uploaded_file($tmpfile, $newfile);

#################
## 쿼리문 실행 ##
#################
/****************************************************
 * UPDATE 형식 : 
 *
 * INSERT INTO 테이블명 VALUES(
 * NULL, 'userid값', '제목', '비번', '내용', now(), 
 * 'IP주소', 0, '파일명');
 ****************************************************/

$query = "INSERT INTO $TBNAME VALUES(
                      NULL, 
                     '" . $_POST['userid'] . "',
                     '" . $_POST['title'] .     "',
                     '" . $_POST['passwd'].     "',
                     '" . $_POST['content'] .   "',
                     now(),
					 '" . $_SERVER['REMOTE_ADDR'] . "',
					 0, 
					 '"  . $_FILES['upfile']['name'] . "'
					 )";

/****************************************************
 * query 문자열 디버깅
 * echo $query;
 * exit;
 ****************************************************/

# resource mysql_query(쿼리문, 연결정보)
$result = mysqli_query($connect, $query);

#####################
## mysql 접속 종료 ##
#####################
mysqli_close($connect);

#################
## 페이지 이동 ##
#################
switch($TBNAME)
{
    case "bbs1" : $menupage = "menu1.html"; break;
	case "bbs2" : $menupage = "menu2.html"; break;
	case "bbs3" : $menupage = "menu3.html"; break;
	case "bbs4" : $menupage = "menu4.html"; break;
	case "bbs5" : $menupage = "menu5.html"; break;
}
?>

<script language=javascript>
    location.href = '/' + '<?=$menupage?>';
</script>
